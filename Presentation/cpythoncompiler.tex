%   Borrowed from A. Shafiei
%
%   Copyright (c)  2023  A. Shafiei
%   Permission is granted to copy, distribute and/or modify this document
%    under the terms of the GNU Free Documentation License, Version 1.3
%    or any later version published by the Free Software Foundation;
%    with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
%    A copy of the license is included in the section entitled "GNU
%    Free Documentation License".

\documentclass[aspectratio=169, dvipsnames, svgnames, x11names]{beamer}

% URLs and hyperlinks ---------------------------------------
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=NavyBlue,
    filecolor=magenta,      
    urlcolor=blue,
}
\usepackage{xurl}
%---------------------------------------------------

\usefonttheme{serif}
\usepackage{graphicx}
\usepackage{amsfonts}
\usepackage{mathtools, nccmath}
\usepackage{amssymb, amsmath}
\usepackage{xspace}
\usepackage{tikz}
\usepackage{standalone}
\usepackage{euler}
\usepackage{color,xcolor}
\usepackage{fontspec}
\usepackage{nameref}
\usepackage{manfnt}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage{algorithmicx}
\usepackage{docs/style}

\input{docs/macros}
\input{figs/figstyle}

\title{How CPython Compiler Works}
\author{Mahdi Haghverdi}

\institute{
\\\includegraphics[height=1.2cm]{logos/logo}\\
Isfahan University
}
\date{}

\begin{document}
    
\begin{frame}[plain]
\begin{center}
In the name of Allah
\end{center}
\maketitle
\end{frame}

\setcounter{framenumber}{0}
\raggedleft

\begin{frame}{Content}
\begin{flushleft}
\tableofcontents
\end{flushleft}
\end{frame}

\section{Overview}
\begin{frame}{Overview}
\begin{itemize}
\item[-]
Which steps does CPython takes to compile your source code?
\item[-]
Why these steps?
\item[-]
How they are done?
\end{itemize}
\end{frame}

\subsection{Diagram}
\begin{frame}{Diagram}
\begin{itemize}
\item[-] 
{\small \ttfamily 
----------------------------------------------------------- \\
| Decoding -> Tokenizing -> Parsing -> AST | -> Compiling | \\
----------------------------------------------------------- \\
}

\item[-]
Front-end: Decoding, Tokenizing, Parsing and AST

\item[-]
Back-end: Compiling
\end{itemize}
\end{frame}

\subsection{Explantion}
\begin{frame}{Explanation}
\begin{itemize}
\item[-]<1->
We’ve got a front-end and a back-end part in this process.

\item[-]<2->
Front-end: getting down to the AST

\item[-]<3->
Back-end: to get the generated AST and compile it down to something

\item[-]<4->
Good example is \href{https://www.pypy.org/}{PyPy} which is a front-end for Python

\item[-]<5->
Ease of writing the code

\item[-]<6->
A better view to the process
\end{itemize}
\end{frame}

\section{Decoding - ``Bytes" to ``Text"}
\begin{frame}{Decoding - ``Bytes" to ``Text"}
\begin{itemize}
{\LARGE \item[-] Translate bytes from disk to actual text}
\end{itemize}
\end{frame}

\subsection{Encoding Declaration}
\begin{frame}{Encoding Declaration}
\begin{itemize}
\item[-] As of \href{https://peps.python.org/pep-0263/}{PEP 263}, you can specify the encoding of your Python module (basically a module is a text
file which python code is written into) at the very top line of the file something like:
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Encoding Declaration (Cont'd)}

\begin{flushleft}
Declaration:
\begin{lstlisting}
#!/usr/bin/python
# -*- coding: <encoding name> -*-
\end{lstlisting}
\end{flushleft}

\begin{flushleft}
e.g.
\begin{lstlisting}[language=python, keywordstyle=\color{Mulberry}\textbf]
#!/usr/bin/python
# -*- coding: ascii -*-

import math
print(math.sin(math.radians(90)))  # 1.0
\end{lstlisting}
\end{flushleft}
\end{frame}

\begin{frame}[fragile]{Encoding Declaration (Cont'd)}
\begin{flushleft}
Which gets compiled like this:
\begin{lstlisting}[language=python]
re.compile("conding[:=]\s*([-\w.]+)")
\end{lstlisting}
\end{flushleft}
\end{frame}

\subsection{Default encoding and Non-ASCII characters}
\begin{frame}{Default Encoding and Non-ASCII Characters}
\begin{itemize}
\item[-]
From \href{https://peps.python.org/pep-3120/}{PEP 3120} UTF-8 is considered as the default enconding, and along with this with \href{https://peps.python.org/pep-3131/}{PEP 3131}

\item[-]
Python supports Non-ASCII identifiers also, this means that you can use french or germen alphabet
(with accent) in your variable names, like:
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Default Encoding and Non-ASCII Characters (Cont'd)}
\begin{lstlisting}[language=python, keywordstyle=\color{Mulberry}\textbf]
löwis = 'Löwis'
print(löwis)
\end{lstlisting}
\end{frame}
\section{Tokenizing - `Text`" to ``Words"}
\begin{frame}{Tokenizing - `Text`" to ``Words"}
\begin{itemize}
{\LARGE \item[-] Take the text and break it up into words}
\end{itemize}
\end{frame}

\subsection{{\ttfamily tokenize} library}

\section{Parsing - ``Words" to ``Sentence"}
\begin{frame}{Parsing - ``Words" to ``Sentence"}
\begin{itemize}
{\LARGE \item[-] Take the words and make sentences out of them}
\end{itemize}
\end{frame}

\section{Abstract Systax Tree - ``Sentence" to ``Semantics"}
\begin{frame}{Abstract Systax Tree - ``Sentence" to ``Semantics"}
\begin{itemize}
{\LARGE \item[-] Take the sentences and figures out what the heck you are saying}
\end{itemize}
\end{frame}

\section{Compiling - ``Sematics" to ``Bytecode"}
\begin{frame}{Compiling - ``Sematics" to ``Bytecode"}
\begin{itemize}
{\LARGE \item[-] Take the AST and generates the bytecode to be executed}
\end{itemize}
\end{frame}

\subsection{Bytecode}
\subsection{Where is {\ttfamily stdlib}}

\end{document}
